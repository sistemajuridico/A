<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.A | Legal Intelligence Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['Playfair Display', 'serif'] },
                    colors: { deep: '#020617', panel: '#0f172a', bordercolor: '#1e293b', brand: { 500: '#3b82f6' } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: #f1f5f9; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .btn-premium { background: linear-gradient(135deg, #1d4ed8, #3b82f6); box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .timeline-item::before { content: ''; position: absolute; left: -17px; top: 5px; width: 12px; height: 12px; border-radius: 50%; background: #3b82f6; border: 2px solid #020617; }
        .ai-glow { animation: pulse-glow 2s infinite ease-in-out; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.2); } 50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); } }
    </style>
</head>
<body class="flex h-screen antialiased">

    <aside id="sidebar" class="hidden md:flex flex-col w-80 border-r border-bordercolor bg-panel h-full z-50 fixed md:relative transition-all">
        <div class="p-8 border-b border-bordercolor text-center flex justify-between items-center md:block">
            <h1 class="font-serif text-3xl font-bold text-white">M.A</h1>
            <button onclick="toggleMenu()" class="md:hidden text-slate-500 text-2xl"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="p-6 space-y-6 overflow-y-auto">
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Credenciais</label>
                <input type="password" id="apiKey" class="w-full bg-deep border border-bordercolor p-3 rounded-lg text-sm text-white outline-none focus:border-brand-500" placeholder="Gemini API Key">
            </div>
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Especialidade</label>
                <select id="areaDireito" class="w-full bg-deep border border-bordercolor p-3 rounded-lg text-sm text-white">
                    <option>Direito Civil e Consumidor</option>
                    <option>Direito de Família</option>
                    <option>Direito Penal</option>
                    <option>Direito do Trabalho</option>
                </select>
            </div>
            <div class="pt-6 border-t border-bordercolor">
                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Assinatura</label>
                <input type="text" id="advNome" class="w-full bg-deep border border-bordercolor p-3 rounded-lg text-sm text-white mb-2" placeholder="Nome">
                <input type="text" id="advOAB" class="w-full bg-deep border border-bordercolor p-3 rounded-lg text-sm text-white mb-2" placeholder="OAB">
                <textarea id="advEndereco" class="w-full bg-deep border border-bordercolor p-3 rounded-lg text-sm text-white resize-none" rows="2" placeholder="Endereço"></textarea>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
        <div class="md:hidden flex justify-between p-4 bg-panel border-b border-bordercolor">
            <span class="font-bold text-brand-500">M.A ELITE</span>
            <button onclick="toggleMenu()" class="text-white"><i class="fa-solid fa-bars"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 md:p-10">
            <div class="max-w-6xl mx-auto space-y-8">
                <header>
                    <h2 class="text-4xl font-serif font-bold text-white italic">Motor de <span class="text-brand-500">Combate Jurídico</span></h2>
                    <p class="text-slate-400">Extração multimodal, cronologia e análise de vulnerabilidades.</p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <div class="lg:col-span-3 glass rounded-2xl p-6">
                        <textarea id="fatosCaso" rows="8" class="w-full bg-transparent text-lg text-slate-200 outline-none resize-none" placeholder="Relate o caso ou suba arquivos de áudio/vídeo da audiência..."></textarea>
                    </div>
                    <div class="lg:col-span-1 flex flex-col gap-4">
                        <div class="flex-1 border-2 border-dashed border-slate-700 rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer hover:border-brand-500 transition-all" onclick="document.getElementById('arquivos').click()">
                            <input type="file" id="arquivos" multiple accept=".pdf,audio/*,video/*" class="hidden" onchange="updateFileLabel()">
                            <i class="fa-solid fa-folder-open text-3xl text-slate-600 mb-2"></i>
                            <p class="text-[10px] uppercase font-bold text-slate-500" id="fileLabel">Anexar Autos & Mídia</p>
                        </div>
                        <button onclick="processar()" class="btn-premium p-5 rounded-2xl font-bold text-white ai-glow">ANÁLISE MULTIMODAL</button>
                    </div>
                </div>

                <div id="loader" class="hidden text-center py-10">
                    <div class="inline-block w-10 h-10 border-4 border-brand-500 border-t-transparent rounded-full animate-spin"></div>
                    <p class="mt-4 text-brand-500 font-bold animate-pulse">Cruzando depoimentos e autos...</p>
                </div>

                <div id="results" class="hidden space-y-8">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-xs font-black text-brand-500 uppercase mb-6"><i class="fa-solid fa-clock-rotate-left mr-2"></i> Linha do Tempo</h3>
                            <div id="timelineContainer" class="ml-4 border-l border-slate-700 pl-6 space-y-6 relative"></div>
                        </div>
                        <div class="glass rounded-2xl p-6 border-t-4 border-red-500">
                            <h3 class="text-xs font-black text-red-500 uppercase mb-6"><i class="fa-solid fa-shield-crack mr-2"></i> Vulnerabilidades Contraparte</h3>
                            <ul id="vulnerabilidades" class="space-y-4"></ul>
                        </div>
                        <div class="glass rounded-2xl p-6">
                            <h3 class="text-xs font-black text-emerald-500 uppercase mb-6"><i class="fa-solid fa-bolt mr-2"></i> Parecer Estratégico</h3>
                            <p id="parecer" class="text-slate-300 text-sm italic leading-relaxed"></p>
                        </div>
                    </div>

                    <div class="glass rounded-3xl p-8 border border-white/5">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-serif text-2xl text-white">Minuta de Alta Performance</h3>
                            <button onclick="baixarDoc()" class="bg-white text-black px-6 py-2 rounded-lg font-bold text-xs hover:bg-brand-500 hover:text-white transition-all">EXPORTAR WORD</button>
                        </div>
                        <textarea id="peca" rows="20" class="w-full bg-deep/50 p-6 rounded-2xl text-sm font-serif leading-relaxed text-slate-400 border border-white/5"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('hidden'); document.getElementById('sidebar').classList.toggle('flex'); }
        function updateFileLabel() { const c = document.getElementById('arquivos').files.length; document.getElementById('fileLabel').innerText = c + " ARQUIVOS CARREGADOS"; }

        async function processar() {
            const apiKey = document.getElementById('apiKey').value;
            if(!apiKey) return alert("Insira a API Key");
            
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            const fd = new FormData();
            fd.append("api_key", apiKey);
            fd.append("fatos_do_caso", document.getElementById('fatosCaso').value);
            fd.append("area_direito", document.getElementById('areaDireito').value);
            const files = document.getElementById('arquivos').files;
            for(let f of files) fd.append("arquivos", f);

            try {
                const res = await fetch('/analisar', { method: 'POST', body: fd });
                const d = await res.json();

                document.getElementById('parecer').innerText = d.resumo_estrategico;
                document.getElementById('peca').value = d.peca_processual;

                // Render Timeline
                const tc = document.getElementById('timelineContainer');
                tc.innerHTML = '';
                d.timeline.forEach(t => {
                    tc.innerHTML += `<div class="timeline-item relative">
                        <span class="text-[10px] font-bold text-brand-500">${t.data}</span>
                        <p class="text-xs text-white font-medium">${t.evento}</p>
                        ${t.alerta ? `<p class="text-[9px] text-red-400 mt-1 italic">⚠️ ${t.alerta}</p>` : ''}
                    </div>`;
                });

                // Render Vulnerabilidades
                const vc = document.getElementById('vulnerabilidades');
                vc.innerHTML = '';
                d.vulnerabilidades_contraparte.forEach(v => {
                    vc.innerHTML += `<li class="p-3 bg-red-500/5 border border-red-500/20 rounded-lg text-xs text-slate-400"><i class="fa-solid fa-crosshairs text-red-500 mr-2"></i> ${v}</li>`;
                });

                document.getElementById('loader').classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
            } catch (e) { alert("Erro no processamento."); document.getElementById('loader').classList.add('hidden'); }
        }

        async function baixarDoc() {
            const res = await fetch('/gerar_docx', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    texto_peca: document.getElementById('peca').value,
                    advogado_nome: document.getElementById('advNome').value,
                    advogado_oab: document.getElementById('advOAB').value,
                    advogado_endereco: document.getElementById('advEndereco').value
                })
            });
            const b = await res.blob();
            const u = window.URL.createObjectURL(b);
            const a = document.createElement('a'); a.href = u; a.download = "MA_Elite_Estrategia.docx"; a.click();
        }
    </script>
</body>
</html>
